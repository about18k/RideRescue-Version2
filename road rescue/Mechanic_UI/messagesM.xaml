<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="road_rescue.messagesM"
             Title="Messages"
             Shell.TabBarIsVisible="False"
             BackgroundColor="#edf2fb"
             Shell.FlyoutBehavior="Disabled"
             >

    <AbsoluteLayout>

        <!-- Drawer Menu -->
        <Grid x:Name="DrawerMenu"
              WidthRequest="280"
              AbsoluteLayout.LayoutBounds="0,0,280,1"
              AbsoluteLayout.LayoutFlags="PositionProportional,HeightProportional"
              TranslationX="-280"
              ZIndex="10"
              BackgroundColor="White">

            <VerticalStackLayout Spacing="0" VerticalOptions="FillAndExpand">

                <!-- Drawer Header with Logo -->
                <Grid BackgroundColor="#21499F" HeightRequest="140" Padding="20">
                    <Image Source="logo2.png" 
                           Aspect="AspectFit"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           HeightRequest="80" />
                </Grid>

                <!-- Profile Section -->
                <Frame BackgroundColor="#D1FAE5"
       CornerRadius="20"
       Padding="16"
       HasShadow="True"
       HorizontalOptions="Fill"
       Margin="20,15">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnProfileTapped" />
                    </Frame.GestureRecognizers>
                    <HorizontalStackLayout Spacing="16" VerticalOptions="Center">
                        <Frame Padding="0"
                               WidthRequest="65"
                               HeightRequest="65"
                               CornerRadius="32.5"
                               IsClippedToBounds="True"
                               HasShadow="False"
                               BackgroundColor="#34D399">
                            <Image Source="stayvepic.png"
                                   Aspect="AspectFill"
                                   WidthRequest="65"
                                   HeightRequest="65" />
                        </Frame>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="Stayve Alreach T. Fedillaga"
                                   FontAttributes="Bold"
                                   FontSize="18"
                                   TextColor="#111827" />
                            <Label Text="Mechanic"
                                   FontSize="14"
                                   TextColor="#6B7280" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </Frame>

                <!-- Drawer Menu Items (same as RequestPage) -->
                <ScrollView>
                    <VerticalStackLayout Padding="0" Spacing="0" BackgroundColor="#F9FBFF">

                        <!-- Notifications -->
                        <Grid Padding="16,14" BackgroundColor="#E5E9FF">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Source="notifications_icon.png" HeightRequest="24" WidthRequest="24" VerticalOptions="Center" />
                            <Label Text="Notifications" FontSize="18" FontAttributes="Bold" TextColor="#21499F" VerticalOptions="Center" Grid.Column="1" />
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnNotificationsClicked" />
                            </Grid.GestureRecognizers>
                        </Grid>

                        <BoxView HeightRequest="1" BackgroundColor="#D9E4FF" />

                        <!-- Request -->
                        <Grid Padding="16,14" BackgroundColor="Transparent">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Source="request_icon.png" HeightRequest="24" WidthRequest="24" VerticalOptions="Center" />
                            <Label Text="Request" FontSize="18" FontAttributes="Bold" TextColor="#21499F" VerticalOptions="Center" Grid.Column="1" />
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnRequestClicked" />
                            </Grid.GestureRecognizers>
                        </Grid>

                        <BoxView HeightRequest="1" BackgroundColor="#D9E4FF" />

                        <!-- Messages -->
                        <Grid Padding="16,14" BackgroundColor="Transparent">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Source="messages_icon.png" HeightRequest="24" WidthRequest="24" VerticalOptions="Center" />
                            <Label Text="Messages" FontSize="18" FontAttributes="Bold" TextColor="#21499F" VerticalOptions="Center" Grid.Column="1" />
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnMessagesClicked" />
                            </Grid.GestureRecognizers>
                        </Grid>

                        <BoxView HeightRequest="1" BackgroundColor="#D9E4FF" />

                        <!-- Completed -->
                        <Grid Padding="16,14" BackgroundColor="Transparent">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Source="completed_icon.png" HeightRequest="24" WidthRequest="24" VerticalOptions="Center" />
                            <Label Text="Completed" FontSize="18" FontAttributes="Bold" TextColor="#21499F" VerticalOptions="Center" Grid.Column="1" />
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnCompleteClicked" />
                            </Grid.GestureRecognizers>
                        </Grid>
                    </VerticalStackLayout>
                </ScrollView>

                <Frame Grid.Row="1"
           BackgroundColor="#F3F4F6"
           HasShadow="False"
           Padding="16"
           Margin="0"
           BorderColor="#E5E7EB">
                    <Label Text="Logout"
               FontSize="18"
               FontAttributes="Bold"
               TextColor="Black"
               HorizontalOptions="Start"
               Margin="85,200"
               VerticalOptions="Center">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnLogoutTapped" />
                        </Label.GestureRecognizers>
                    </Label>
                </Frame>


            </VerticalStackLayout>
        </Grid>

        <!-- Overlay to dim main content and close drawer on tap -->
        <BoxView x:Name="DrawerOverlay"
                 AbsoluteLayout.LayoutBounds="0,0,1,1"
                 AbsoluteLayout.LayoutFlags="All"
                 BackgroundColor="#000000"
                 Opacity="0.4"
                 IsVisible="False"
                 ZIndex="9">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnOverlayTapped" />
            </BoxView.GestureRecognizers>
        </BoxView>

        <!-- Main Content Area -->
        <Grid AbsoluteLayout.LayoutBounds="0,0,1,1"
              AbsoluteLayout.LayoutFlags="All"
              ZIndex="5"
              BackgroundColor="#edf2fb"
              RowDefinitions="Auto,*">

            <!-- Top Bar with Menu Icon and Title -->
            <Grid BackgroundColor="White"
                  Padding="15,10"
                  ColumnDefinitions="Auto,Auto,*"
                  VerticalOptions="Start"
                  HeightRequest="60"
                  Row="0">

                <Label Text="â˜°"
                       FontSize="30"
                       HorizontalOptions="End"
                       VerticalOptions="Center"
                       Margin="0,0,0,4"
                       Grid.Column="2">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Tapped="TapGestureRecognizer_Tapped" />
                    </Label.GestureRecognizers>
                </Label>

                <Label Text="Messages"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="#21499F"
                       VerticalOptions="Center"
                       HorizontalOptions="Start"
                       Margin="10,0,0,0"
                       Grid.Column="1" />
            </Grid>

            <!-- Messages List -->
            <ScrollView Grid.Row="1">
                <VerticalStackLayout Padding="20" Spacing="20">
                    <CollectionView x:Name="MessagesList" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Stroke="#e0e0e0"
                                        StrokeThickness="1"
                                        BackgroundColor="White"
                                        StrokeShape="RoundRectangle 15"
                                        Padding="10">
                                    <Grid ColumnSpacing="10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <Image Source="{Binding ProfileImage}"
                                               WidthRequest="50"
                                               HeightRequest="50"
                                               Aspect="AspectFill">
                                            <Image.Clip>
                                                <EllipseGeometry Center="25,25" RadiusX="25" RadiusY="25"/>
                                            </Image.Clip>
                                        </Image>

                                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                                            <Label Text="{Binding SenderName}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   TextColor="Black" />
                                            <Label Text="{Binding MessagePreview}"
                                                   FontSize="14"
                                                   TextColor="Gray"
                                                   LineBreakMode="TailTruncation" />
                                            <Label Text="{Binding TimeSent}"
                                                   FontSize="12"
                                                   TextColor="LightGray"
                                                   HorizontalOptions="End"/>
                                        </VerticalStackLayout>
                                    </Grid>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding TapCommand}" />
                                    </Border.GestureRecognizers>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </ScrollView>
        </Grid>
    </AbsoluteLayout>
</ContentPage>
